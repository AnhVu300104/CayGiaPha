@model IEnumerable<CayGiaPha.Models.FamilyTreeViewModel>

@{
    ViewData["Title"] = "Cây Gia Phả";
}

<h1 style="text-align:center">CÂY GIA PHẢ</h1>

@if (!Model.Any())
{
    <p>Không có dữ liệu gia phả nào. Vui lòng thêm thành viên trước.</p>
}
else
{
    <div class="tree-container">
        @foreach (var family in Model)
        {
            if(family.FamilyName!="Other")
            {
                <div class="family-section">
                    <h2>Cây Gia Phả Họ @family.FamilyName</h2>
                    @foreach (var couple in family.Couples)
                    {
                        <div class="couple-group">
                            <div class="couple-info">
                                <strong>Họ @family.FamilyName</strong>
                                <br />
                                - @(couple.HusbandName ?? "Không rõ") @(couple.HusbandAge.HasValue ? $"({couple.HusbandAge})" : "") @(couple.HusbandGender == "Nam" ? "♂" : couple.HusbandGender == "Nữ" ? "♀" : "") + @(couple.WifeName ?? "Không rõ") @(couple.WifeAge.HasValue ? $"({couple.WifeAge})" : "") @(couple.WifeGender == "Nam" ? "♂" : couple.WifeGender == "Nữ" ? "♀" : "")
                            </div>

                            @if (couple.Children.Any())
                            {
                                <div class="children-list">
                                    @{var dem = 0;}
                                    @foreach (var child in couple.Children)
                                    {
                                        var found = false;
                                        

                                        foreach (var co in family.Couples)
                                        {
                                            if (co.HusbandName == child.Name || co.WifeName == child.Name)
                                            {
                                                found = true;
                                                dem++;
                                                if (dem == 2)
                                                {
                                                    dem = 0;
                                                    break;
                                                }                                           

                                                <div class="child-item">
                                                    - @(co.HusbandName ?? "Không rõ")
                                                    @(co.HusbandAge.HasValue ? $"({co.HusbandAge})" : "")
                                                    @(co.HusbandGender == "Nam" ? "♂" : co.HusbandGender == "Nữ" ? "♀" : "")
                                                    +
                                                    @(co.WifeName ?? "Không rõ")
                                                    @(co.WifeAge.HasValue ? $"({co.WifeAge})" : "")
                                                    @(co.WifeGender == "Nam" ? "♂" : co.WifeGender == "Nữ" ? "♀" : "")
                                                </div>

                                                @* Hiển thị con cháu của họ *@
                                                if (co.Children.Any())
                                                {
                                                    <div class="children-list">
                                                        @foreach (var chi in co.Children)
                                                        {
                                                            <div class="child-item">
                                                                - @chi.Name
                                                                @(chi.Age.HasValue ? $"({chi.Age})" : "")
                                                                @(chi.Gender == "Nam" ? "♂" : chi.Gender == "Nữ" ? "♀" : "")
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="no-children">
                                                        - Không có con
                                                    </div>
                                                }

                                                break; // thoát vòng foreach co
                                            }
                                        }

                                        if (!found)
                                        {
                                            <div class="child-item">
                                                - @child.Name
                                                @(child.Age.HasValue ? $"({child.Age})" : "")
                                                @(child.Gender == "Nam" ? "♂" : child.Gender == "Nữ" ? "♀" : "")
                                            </div>
                                        }
                                    }
                                </div>
                            }
                            else
                            {
                                <div class="no-children">
                                    - Không có con
                                </div>
                            }

                        </div>
                        break;
                    }
                </div>
            }
            
        }
    </div>
}

<style>
    .tree-container {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }

    .family-section {
        margin-bottom: 30px;
        padding: 15px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .family-section h2 {
        color: #2c3e50;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    .couple-group {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #ecf0f1;
        border-radius: 6px;
        border-left: 4px solid #3498db;
    }

    .couple-info {
        font-size: 16px;
        color: #34495e;
        margin-bottom: 10px;
    }

    .children-list {
        margin-left: 20px;
    }

    .child-item {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 5px;
        padding-left: 10px;
        border-left: 2px solid #bdc3c7;
        padding-left: 15px;
    }

    .no-children {
        font-size: 14px;
        color: #95a5a6;
        font-style: italic;
        margin-left: 20px;
        padding-left: 15px;
        border-left: 2px solid #bdc3c7;
    }

    .grandchildren-list {
        margin-left: 20px;
    }

    .grandchild-item {
        font-size: 12px;
        color: #7f8c8d;
        margin-bottom: 3px;
        padding-left: 10px;
        border-left: 2px solid #bdc3c7;
        padding-left: 15px;
    }
</style>
